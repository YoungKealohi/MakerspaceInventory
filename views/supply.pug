extends layout

block content
  .start-inventory-container
    a.button-start-inventory(href="/start-inventory") Start Inventory
    a.button-start-inventory(href="/low-stock-report" style="background-color: #ff9800; margin-left: 10px;") Low Stock Report
  h1 #{machine.MachineName}
  p
    a.button-nav(href=`/machines/`) Go Back To List of Machines
  p
    a.button-nav(href=`/machines/${machine.MachineID}/supplies/new`) Add New Supply

  //- Search form
  form.inventory-search(method="get", action=`/machines/${machine.MachineID}/supplies`)
    input.inventory-input(type="text", name="q", placeholder="Search supplies by name...", value=(typeof q !== 'undefined' ? q : ''))
    button.button(type="submit") Search
    if q
      a.button(href=`/machines/${machine.MachineID}/supplies`, style="margin-left:8px") Clear
  
  if supplies.length === 0
    p No supplies yet.
  else
    table(border="1" cellpadding="6" cellspacing="0")
      thead
        tr
          //th ID
          th Name
          th Location
          th Brand
          th Color
          th Count/Status
          th Status
          th Actions
      tbody
        each s in supplies
          tr
            td= s.SupplyName
            td
              if s.Locations && s.Locations.length > 0
                = s.Locations.map(loc => loc.Name).join(', ')
              else
                | -
            td= s.Brand || '-'
            td= s.Color || '-'
            td
              if s.SupplyType === 'Countable'
                = s.Count
              else if s.SupplyType === 'Status'
                if s.Status === 1
                    | Plenty
                else if s.Status === 0
                    | Need more
            
            td
                if s.SupplyType === 'Countable'
                    if s.Count <= s.CriticalLevel
                        span(style="color:red; font-weight:bold") ❌ Needs Order
                    else 
                        span(style="color:green; font-weight:bold") ✅ OK
                else if s.SupplyType === 'Status'
                    if s.Status === 1
                        span(style="color:green; font-weight:bold") ✅ OK
                    else if s.Status === 0
                        span(style="color:red; font-weight:bold") ❌ Needs Order
            td.form
              if machine && machine.MachineID && s && s.SupplyID
                a.button(href=`/machines/${machine.MachineID}/supplies/${s.SupplyID}/edit`) Edit
                form(method="post", action=`/machines/${machine.MachineID}/supplies/${s.SupplyID}/delete`, onsubmit="return confirm('Delete this supply?');")
                  button.delete(type="submit") Delete