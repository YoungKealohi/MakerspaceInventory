extends layout

block content
  .logout-button-container
    a.button-logout(href="/") Log out

  h1 Low Stock Report

  p
    a.button-nav(href="/machines") Back to Machines

  if supplies.length === 0
    p.no-supplies(style="margin: 10px; padding: 20px; background-color: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; color: #155724;") 
      strong Good news!
      |  All supplies are currently at acceptable levels. No items need to be reordered at this time.
  else
    p(style="margin: 10px;") 
      strong #{supplies.length}
      |  supply item(s) need to be reordered. Copy the text below and email it to #{bosses.map(boss => `${boss.FirstName} (${boss.Email})`).join(', ')}.

    .report-text-container(style="margin: 10px;")
      h2 Copy Report Text:
      button#copyButton.button-nav(type="button" style="background-color: #007298; margin: 10px; cursor: pointer;") Copy to Clipboard
      textarea#reportText(readonly style="width: 90%; min-height: 300px; padding: 10px; margin: 10px; font-family: monospace; font-size: 14px; border: 2px solid #ddd; border-radius: 5px; background-color: #f8f9fa;")= reportText
      
    h2 Detailed View:
    table(border="1" cellpadding="6" cellspacing="0" style="margin: 10px;")
      thead
        tr
          th Supply Name
          th Machine
          th Status
          th Location(s)
      tbody
        each supply in supplies
          tr
            td
              = supply.SupplyName
              if supply.Color
                |  (#{supply.Color})
              if supply.Brand
                br
                small Brand: #{supply.Brand}
            td= supply.MachineName || 'N/A'
            td
              if supply.SupplyType === 'Countable'
                | Stock: #{supply.Count} / Critical: #{supply.CriticalLevel}
              else
                | Need More
            td= supply.Locations || 'N/A'

  script.
    document.getElementById('copyButton')?.addEventListener('click', function() {
      const textarea = document.getElementById('reportText');
      textarea.select();
      document.execCommand('copy');
      
      // Change button text temporarily
      const button = this;
      const originalText = button.textContent;
      button.textContent = 'Copied!';
      button.style.backgroundColor = '#28a745';
      
      setTimeout(() => {
        button.textContent = originalText;
        button.style.backgroundColor = '#007298';
      }, 2000);
    });
