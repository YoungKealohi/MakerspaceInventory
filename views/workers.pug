extends layout

block content
  h1 Workers
  p 
    a.button-nav(href=`/machines/`) Go Back To Machines

  - var isViewerAdmin = (typeof isAdmin !== 'undefined') ? isAdmin : ((typeof viewerIsAdmin !== 'undefined') ? viewerIsAdmin : (session && session.isAdmin))
  if isViewerAdmin
    p
      a.button-nav(href="/workers/new") Add New Worker

  table(border="1" cellpadding="6" cellspacing="0")
    thead
      tr
        th Name
        th Role
        th Phone Number
        th Email
        th Specialties
        th Availability
        th Actions
    tbody
      each worker in workers
        tr
          td= worker.FirstName + ' ' + worker.LastName
          if worker.IsAdmin
            td Admin
          else
            td= worker.IsBoss ? 'Boss' : 'Worker'
          td= worker.PhoneNumber || '—'
          td= worker.Email || '—'
          td= worker.specialties || '—'
          td!= worker.availabilityDisplay
          td.form
            - const canEdit = (isViewerAdmin) || (session && session.workerId == worker.WorkerID)
            - const canDelete = !!isViewerAdmin
            if canEdit
              a.button.action-gap(href=`/workers/${worker.WorkerID}/edit`) Edit
            //- Do not render Edit button when not allowed
            // allow admins to grant/revoke admin status
            if canDelete
              form(method="post", action=`/workers/delete/${worker.WorkerID}`, onsubmit="return confirm('Delete this worker?');", class="action-gap")
                button.delete(type="submit") Delete

            // admin toggle removed from list; admin status can be changed on the edit page
            //- Do not render Delete button when not allowed
