extends layout

block content
  if supply && supply.SupplyID
    h1 Edit #{supply.Name} for #{machine.MachineName}
  else
    h1 New Supply for #{machine.MachineName}

  form(method="post", action=formAction)
    div
      label(for="Name") Name:
      input(type="text", name="Name", required, value=supply ? supply.Name : "")

    div
      label(for="Brand") Brand:
      input(type="text", name="Brand", value=supply ? supply.Brand : "")

    div
      label(for="Color") Color:
      input(type="text", name="Color", value=supply ? supply.Color : "")

    div
      label Locations (select multiple):
      div(style="border: 1px solid #ddd; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto;")
        each loc in locations
          div(style="margin-bottom: 8px; display: flex; align-items: center;")
            input(
              type="checkbox", 
              name="LocationIDs", 
              value=loc.LocationID,
              id=`loc_${loc.LocationID}`,
              checked=(selectedLocationIds && selectedLocationIds.includes(loc.LocationID)),
              style="margin: 0;"
            )
            label(for=`loc_${loc.LocationID}`, style="margin-left: 8px; cursor: pointer; margin-bottom: 0;")= loc.Name + (loc.Description ? ` (${loc.Description})` : '')

    div
      label(for="SupplyType") Supply Type:
      select(name="SupplyType", id="supplyType", required, onchange="toggleFields()")
        option(value="") -- Select Type --
        option(value="Countable", selected=(SupplyType === 'Countable')) Countable
        option(value="Status", selected=(SupplyType === 'Status')) Status

    // Countable supplies
    div(id="countableFields", style=`display:${SupplyType === 'Countable' ? 'block' : 'none'}; margin-top:10px`)
      label(for="Count") Count:
      input(type="number", name="Count", min="0", value=countable ? countable.Count : "")
      label(for="CriticalLevel") Critical Level:
      input(type="number", name="CriticalLevel", min="0", value=countable ? countable.CriticalLevel : "")

    // Status supplies
    div(id="statusFields", style=`display:${SupplyType === 'Status' ? 'block' : 'none'}; margin-top:10px`)
      label Status:
      select(name="Status")
        option(value="1", selected=(status && status.Status == 1)) Plenty
        option(value="0", selected=(status && status.Status == 0)) Need More

    div
      button(type="submit")= submitLabel
      a.button-nav-cancel(href=`/machines/${machine.MachineID}/supplies`) Cancel

  script.
    function toggleFields() {
      const type = document.getElementById('supplyType').value;
      document.getElementById('countableFields').style.display =
        type === 'Countable' ? 'block' : 'none';
      document.getElementById('statusFields').style.display =
        type === 'Status' ? 'block' : 'none';
    }
